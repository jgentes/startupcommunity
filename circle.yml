dependencies:
  pre:
    # latest stable chrome
    - curl -L -o google-chrome-stable.deb https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    - sudo dpkg -i google-chrome-stable.deb
    # make chrome lxc-friendly
    - sudo sed -i 's|HERE/chrome\"|HERE/chrome\" --disable-setuid-sandbox|g' /opt/google/chrome/google-chrome
    - rm google-chrome-stable.deb
    # downgrade chromedriver
    - curl -L -o chromedriver.zip "https://chromedriver.storage.googleapis.com/2.12/chromedriver_linux64.zip"
    - unzip -p chromedriver.zip | sudo tee /usr/local/bin/chromedriver >> /dev/null
    - sudo chmod +x "/usr/local/bin/chromedriver"

deployment:
  dev:
    branch: dev
    commands:
      - ./build.sh
      - git config --global user.email "james@thesocialbusiness.com"
      - git config --global user.name "James Gentes"
      - git add . -A
      - git commit -am "Push dev branch to sc-dev:master"      
      - git push git@heroku.com:startupcommunity-dev.git HEAD:master --force      
  production:
    branch: staging
    commands:
      - ./build.sh
      - git config --global user.email "james@thesocialbusiness.com"
      - git config --global user.name "James Gentes"
      - git add . -A
      - git commit -am "Push staging to production master"      
      - git push git@heroku.com:startupcommunity.git HEAD:master --force
      - git push git@github.com:jgentes/startupcommunity.git $CIRCLE_SHA1:master --force